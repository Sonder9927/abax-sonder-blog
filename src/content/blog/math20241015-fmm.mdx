---
title: Fast Marching Method
date: "2024-10-15"
author: Sonder
authorGithub: sonder9927
authorImage: /images/uploads/zard-think.jpg
category: custom
tags:
- math
- inversion
- geophysics
description: Fast marching method
---

# 介绍

Eikonal equation (程函方程) 是使用WKB理论来近似波动方程时，在波动传播问题中碰到的非线
性偏微分方程。
程函方程在数学上为 Hamilton-Jacobian 方程。这个方程有已经很多种求解方法，例如：Fast
sweeping method, Fast marching method, Fast iterative method。

快速行进算法(Fast Marching Method; FMM)，其根本是要实现独立于单元网格的闭合曲面几何特征描述的，属于一种特殊的窄带水平集方法，类似于水平集法该方法根据汉密尔顿-雅克比方程隐式确定移动曲面边界上任一点的法向速度，但是属于简化的汉密尔顿-雅克比运动方程，又称为 Eikonal 方程，即将时间相关的水平集偏微分方程转化为时间无关的静态方程。在求解 Eikonal 方程时将方程中梯度由upwind operators逆风算子代替，确定曲面的变化特征!

FMM是求解程函方程 $F|\nabla T|=1$ 的一种高效数值算法，程函方程属于非线
性偏微分方程，可以认为是一种近似波动方程。在界面演化问题中的求解的结果T的物理含义是曲线以速度 $F(x)$ 到达计算域每一点所需要消耗的最短时间。寻找 $T$ 在不同高度上的水平集，它总能给出时间演化曲线的一个位置。当 $F=1$ 时，方程解就代表计算域中的距离场，也就是所谓的符号距离函数。

FMM 使用了一个特殊的差商代替微商，比如在二维情况，使用的是如下近似：

$$
|\nabla T|^2\approx(\max\{-\Delta_{+x}T,\Delta_{-x}T,0\})^2+(\max\{-\Delta_{+y}T,\Delta_{-y}T,0\})^2
$$

这里的 $\Delta_{+x}$ 表示对于自变量 $x$ 的一阶向前差分算子，$\Delta_{+x}$ 表示对于自变量 $x$ 的一阶向后差分算子。

# 算法推导

同差分思想，$F|\nabla T|=1$ 的一阶近似为:

$$
|\nabla T|^2\approx(\max\{-\Delta_{+x}T,\Delta_{-x}T,0\})^2+(\max\{-\Delta_{+y}T,\Delta_{-y}T,0\})^2
$$

假设$T_1$是$x$方向值较小的一个邻居，$T_2$是$y$方向值较小的一个邻居，$t$是当前待求点的值，为了方便，假设网格步长为$1$（因为算法是基于网格的，若步长不是为$1$，最后的结果乘以网格步长$h$即可），那么有：

$$
(\max\{t-T_1,0\})^2+(\max\{t-T_2,0\})^2=1/F^2
$$

求解这个方程，分几种情况来考虑(假设$T_1\ge T_2$):

- $t>\max\{T_1,T_2\}=T_1$

    求解 $(t-T_1)^2+(t-T_2)^2=1/F^2$，若有实根可得:

    $t=\frac{T_1+T_2+\sqrt{2/F^2-(T_1-T_2)^2}}{2}$

    舍掉了另一个不满足$t>\max\{T_1,T_2\}$根。

- $T_1\ge t > T_2$

    求解$(t-T_2)^2=1/F^2$，因 $F$ 为正，可得:

    $t=T_2+1/F$

在这样的两种条件下，忽略了判别式小于零导致无解的情况。以及忽略了上面的方式求的解不满足关于范围的条件假设。
因此，第一个条件下，还得满足：

$$
\frac{T_1+T_2+\sqrt{2/F^2-(T_1-T_2)^2}}{2}>T_1
$$

即$|T_1- T_2|< 1/F$，显然，这个条件满足了，判别式自然大于零。

在第二个条件下，应满足: $T_2 +1/F \le T1$，即$|T_1-T_2丨\ge 1/F$，刚好和前面一个条件相补。

综上，可以得到如下描述：

- $|T_1-T_2|<1/F$

$$
t=\frac{T_1+T_2+\sqrt{2/F^2-(T_1-T_2)^2}}{2}
$$

- $|T_1-T_2| \ge 1/F$

$$
t=\min\{T_1,T_2\}+1/F
$$

# 算法程序

## 程序代码

[3-D Fast Marching Code](http://rses.anu.edu.au/seismology/soft/fmmcode/)

## 算法描述

<img src="/images/post-images/fmm_algorithm.png" alt="fmm" width="600" height="400"/>

输入的 $F$ 给出了速度场，在求符号距离函数中，$F_{ij}\equiv 1$。$S$ 为源点集，在求符号距离函数中，即为零水平离散点集。$T_s$ 为源点集对应的函数值，在求符号距离函数中，这个值为零。$h$ 为离散空间步长。输出的 $T$ 给出了时间标量场，当求符号距离函数时，它所求解得到的就是符号距离函数的离散表示。对于一个 $N\times N$ 的网格，FMM 的总的算术复杂度为 $O(N\log{N})$，误差阶为 $O(\Delta x)$。

快速行进算法和 Djkstra 算法思想相似，不同之处在于 Djkstra 算法利用节点之间的欧式距离进行更新，而 FMM 算法利用由程函方程化简得到的近似偏微分方程进行更新。快速行进算法有很多特质：

- 首先，它是“一次通过"的算法，减少了不必要的计算；
- 其次，它计算量小，一般只要计算不超过 $N\log{N}$ 次。

在水平集方法中，无符号距离函数的精度是至关重要的。因此，人们针对符号距离函数的重构和初始化提出了很多方法、算法和离散方式。

